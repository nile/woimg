/**
 * RubyOnRails Support Module v2.3.1
 * http://rightjs.org/plugins/rails
 *
 * Copyright (C) 2009-2011 Nikolay Nemshilov
 */
(function(a,b,c){function p(a,c){var d=c.get("href"),e=c.get("data-method"),i=c.get("data-remote"),j=f("meta[name=csrf-param]")[0],n=f("meta[name=csrf-token]")[0];j=j&&j.get("content"),n=n&&n.get("content");if(!k(a,c)){(e||i)&&a.stop();if(i)h.load(d,l(c,{method:e||"get",spinner:c.get("data-spinner"),params:(new Function('return {"'+j+'": "'+n+'"}'))()}));else if(e){var o=g("form",{action:d,method:"post"});j&&n&&o.insert('<input type="hidden" name="'+j+'" value="'+n+'" />'),o.insert('<input type="hidden" name="_method" value="'+e+'"/>').insertTo(b.body).submit(),m(c)}}}function o(a){return a.has("data-disable-with")?d([a]):a.find("*[data-disable-with]")}function n(a){o(a).each(function(a){if(a.__disable_with_html!==undefined){var b=a instanceof j?"value":"html";a[b](a.__disable_with_html),delete a.__disable_with_html}})}function m(a){o(a).each(function(a){var b=a instanceof j?"value":"html";a.__disable_with_html=a[b](),a[b](a.get("data-disable-with"))})}function l(a,b){return i.merge({onCreate:function(){m(a),a.fire("ajax:loading",{xhr:this})},onComplete:function(){n(a),a.fire("ajax:complete",{xhr:this})},onSuccess:function(){a.fire("ajax:success",{xhr:this})},onFailure:function(){a.fire("ajax:failure",{xhr:this})}},b)}function k(a,b){var c=b.get("data-confirm");if(c&&!confirm(c)){a.stop();return!0}}var d=c,e=c.$,f=c.$$,g=c.$E,h=c.Xhr,i=c.Object,j=c.Input;c.Rails={version:"2.3.1"},d([c.String.prototype,c.Array.prototype,c.Function.prototype,c.Object,c.Options,c.Observer,c.Observer.prototype,c.Window.prototype,c.Document.prototype]).each(function(a){for(var b in a)try{if(/[A-Z]/.test(b)&&typeof a[b]==="function"){var c=d(b).underscored();if(a[c]===null||a[c]===undefined)a[c]=a[b]}}catch(e){}}),d([c.Element,c.Event,c.Form,c.Input]).each(function(a){if(a){var b={},c=a.prototype;for(var e in c)/[A-Z]/.test(e)&&typeof c[e]==="function"&&(a.prototype[d(e).underscored()]=c[e])}}),c.$alias(c.String.prototype,{index_of:"indexOf",last_index_of:"lastIndexOf",to_f:"toFloat",to_i:"toInt",gsub:"replace",downcase:"toLowerCase",upcase:"toUpperCase",index:"indexOf",rindex:"lastIndexOf",strip:"trim"}),c.$alias(c.Array.prototype,{collect:"map",detect:"filter",index_of:"indexOf",last_index_of:"lastIndexOf",index:"indexOf",rindex:"lastIndexOf"}),e(b).on({click:function(a){var b=a.find("a");b&&p(a,b)},submit:function(a){var b=a.target;b.has("data-remote")&&!k(a,b)&&(a.stop(),b.send(l(b,{spinner:b.get("data-spinner")||b.first(".spinner")})))}});var q={Options:{format:"js",flashId:"flashes",flashHideFx:"slide",flashHideDelay:3200,highlightUpdates:!0,removeFx:"fade",insertFx:"fade",insertPosition:"bottom",linkToAjaxEdit:".ajax_edit",linkToAjaxDelete:".ajax_delete",rescanWithScopes:!0},update_flash:function(a){var b=e(this.Options.flashId);b&&this.replace(b,a).hide_flash();return this},hide_flash:function(){if(this.Options.flashHideDelay>-1){var a=e(this.Options.flashId);a&&a.visible()&&a.hide.bind(a,this.Options.flashHideFx).delay(this.Options.flashHideDelay)}return this},highlight:function(a){e(a)&&this.Options.highlightUpdates&&e(a).highlight();return this},insert:function(a,b,c){var d=c||this.Options.insertPosition,f,g=e(a).insert(b,d);switch(d){case"bottom":f=g.children().last();break;case"top":f=g.first();break;case"before":f=g.prev();break;case"after":f=g.next()}f&&this.Options.insertFx?f.hide().show(this.Options.insertFx,{onFinish:this.highlight.bind(this,f)}):this.highlight(f);return this.rescan(a)},replace:function(a,b){e(a).replace(b);return this.highlight(a).rescan(a)},remove:function(a){e(a)&&e(a).remove(this.Options.removeFx)},remotize_form:function(a){var b=e(a);b&&(b.remotize().enable()._.action+="."+this.Options.format);return this},replace_form:function(a,b){var c=e(a);c&&(c.replace(b),this.remotize_form(a));return this.rescan(a)},show_form_for:function(a,b){e(a).find("form").each("remove"),e(a).insert(b);return this.remotize_form(e(a).first("form")).rescan(a)},process_click:function(a){var b;(b=a.find("a"+this.Options.linkToAjaxEdit))?(a.stop(),h.load(b.get("href")+"."+this.Options.format)):(b=a.find("a"+this.Options.linkToAjaxDelete))&&b.has("onclick")&&(a.stop(),(new Function("return "+b.onclick.toString().replace(".submit",".send")))().call(b))},rescan:function(b){$w("Draggable Droppable Tabs Tags Selectable").each(function(c){c in a&&a[c].rescan(this.Options.rescanWithScopes?b:null)},this);return this}};e(b).on({ready:function(){q.hide_flash()},click:function(a){q.process_click(a)}}),a.RR=q})(window,document,RightJS)